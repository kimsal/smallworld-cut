if (self.CavalryLogger) { CavalryLogger.start_js(["VdNG1"]); }

__d('ViewportTrackingHooks',['Base64'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();var h={},i=[],j={registerFeedObject:function k(l,m){h[l]=c('Base64').encode(m);},updateVisibleViewportObjects:function k(l){var m=[],n=false;for(var o=0;o<l.length;o++){var p=l[o],q=p.id;while(!(q in h)&&p.firstChild!=undefined&&p.firstChild.id!=undefined&&p.firstChild.id.startsWith("u_")){q=p.firstChild.id;p=p.firstChild;}if(q in h){m.push(h[q]);if(!(o in i)||i[o]!=h[q])n=true;}}if(!n&&i.length!=m.length)n=true;if(n){i=m;if(typeof __EXT__updateVisibleViewportObjects==='function')__EXT__updateVisibleViewportObjects(i);}}};f.exports=j;}),null);
__d('viewportTrackingBuilder',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=function i(j){var k=null;return {factory:j,singleton:function l(){if(!k)k=j.apply(undefined,arguments);return k;},clearSingleton:function l(){k=null;}};};f.exports=h;}),null);
__d('ViewportTracking',['cx','invariant','Arbiter','AsyncSignal','Banzai','BanzaiScuba','CSS','CurrentUser','DOM','DOMDimensions','Event','LitestandMessages','NavigationMessage','Run','SubscriptionsHandler','UserActivity','Vector','ViewportTrackingHelper','ViewportTrackingHooks','clickRefAction','collectDataAttributes','debounce','getElementPosition','getViewportDimensions','throttle','viewportTrackingBuilder'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=97,k=51,l='vpv',m='/feed/feed_tracking/vpv_waterfall_logging',n=3,o=2,p=1,q=0,r=1,s=2,t=3,u=4;function v(y){this.cachedAllStories=[];this.cachedVisibleStories={init:false,data:{}};this.fireTimer=this.fireTimer.bind(this);this.logAnnotatedVPV=this.logAnnotatedVPV.bind(this);this.markStoryRead=this.markStoryRead.bind(this);this.behavior=y;}v.prototype.init=function(y){this.useBanzai=true;this.vpvDebug=!!y.vpv_debug;this.vpvdDebug=!!y.vpvd_debug;this.vpvdAnalysis=!!y.vpvd_analysis;this.trackingHooks=!!y.tracking_hooks;this.useWaterfallLogging=!!y.waterfall_logging;this.loggedStoryIDs={};this.readStoryIDs={};this.annotatedStoryIDs={};this.minSizeToBeVisible=200;this.minFractionToBeVisibleForTimetracking=.5;this.scrollThrottlingInterval=100;this.mouseThrottlingInterval=100;this.keyboardThrottlingInterval=100;this.minTimeToReportImmediately=500;this.discardVPVDIntervalThreshold=90000;this.active_state_duration=1000;this.height_diff_to_change_state=25;this.focused_state_duration=3500;this.invalidateAllStoriesCache();this.cachedViewportHeight=c('getViewportDimensions')().height;this.isTimetrackingEnabled=false;this.activeStories={};this.userInactiveLock=false;this.userActivityPollerTimeoutID=-1;this._headLoadStoryCount=0;if(this.behavior.getDataFromConfig)this.behavior.getDataFromConfig(y,this);if(this.isTimetrackingEnabled){this.lastMouseX=-1;this.lastMouseY=-1;this.lastStreamY=-1;this.latestStreamYChangedTimeStamp=-1;this.userFocus=s;this.latestUserFocus=s;this.latestUserActivity='init';this.focusedStory=null;this.latestFocusedStory=null;this.latestActiveStory=null;this.totalVPVDuration={};}this.isLoose=!!y.is_loose;this.maxScrollPosition=0;if(y.tracking_duration_config){this.scrollThrottlingInterval=y.tracking_duration_config.scroll_throttling_interval;this.mouseThrottlingInterval=y.tracking_duration_config.mouse_throttling_interval;this.keyboardThrottlingInterval=y.tracking_duration_config.keyboard_throttling_interval;this.userActivityPollingInterval=y.tracking_duration_config.user_activity_polling_interval;this.timeToBeConsideredInactive=y.tracking_duration_config.time_to_be_considered_inactive;this.minFractionToBeVisibleForTimetracking=y.tracking_duration_config.min_fraction_to_be_visible;this.minTimeToReportImmediately=y.tracking_duration_config.min_time_to_report_immediately;this.active_state_duration=y.tracking_duration_config.active_state_duration;this.height_diff_to_change_state=y.tracking_duration_config.story_height_diff_to_change_state;this.focused_state_duration=y.tracking_duration_config.focused_state_duration;this.discardVPVDIntervalThreshold=y.tracking_duration_config.discard_vpvd_interval_threshold;}!(y.record_delay!==undefined)?i(0):void 0;var z,aa=c('debounce')(this.fireTimer,y.record_delay,this);if(this.isLoose){this.minSizeToBeVisible=0;z=c('throttle')(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,c('Vector').getScrollPosition().y);aa();}.bind(this));}else z=aa;this.initialStories=this.getStoriesInView();this.initialStoriesLogged=false;if(this.annotatedVPVLogging)this.initialStories.forEach(this.logAnnotatedVPV,this);if(this.useWaterfallLogging)this.getStoriesInView().forEach(function(ea){this.waterfallLogStep(ea,'100_all_stories_in_view_ignore_height',true);}.bind(this));this.subscriptions=new (c('SubscriptionsHandler'))();this.subscriptions.addSubscriptions(this._getScrollListener(z),c('Event').listen(window,'resize',function(){this.invalidateVisibleStoriesCache();this.cachedViewportHeight=c('getViewportDimensions')().height;z();}.bind(this)),c('Event').listen(window,'focus',function(){if(this.isTimetrackingEnabled)this.updateTimeTrackingData(false,'window_focus');}.bind(this)),c('Event').listen(window,'blur',function(){if(this.isTimetrackingEnabled)this.updateTimeTrackingData(true,'window_blur');}.bind(this)),c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,this.cleanup.bind(this)),c('Arbiter').subscribe('Stream/totalHeadLoadedStories',function(ea,fa){this._headLoadStoryCount=fa.count;}.bind(this)),c('Arbiter').subscribe(c('LitestandMessages').STORIES_INSERTED,function(){if(!this.initialStoriesLogged){var ea=this.getStoriesInView();ea.forEach(this.logAnnotatedVPV,this);}else z();if(this.isTimetrackingEnabled)this.updateTimeTrackingData(false,'stories_inserted');}.bind(this)));if(this.isTimetrackingEnabled&&this.behavior.getStream){this.updateTimeTrackingData(false,'init');var ba=c('throttle')(function(event){this.invalidateVisibleStoriesCache();this.handleScroll(event);}.bind(this),this.scrollThrottlingInterval),ca=c('throttle')(function(event){return this.handleKeyboard(event);}.bind(this),this.keyboardThrottlingInterval),da=c('throttle')(function(event){return this.handleMouse(event);}.bind(this),this.mouseThrottlingInterval);this.subscriptions.addSubscriptions(c('Event').listen(window,'scroll',ba),c('Event').listen(document.documentElement,'DOMMouseScroll',ba),c('Event').listen(document.documentElement,'mousewheel',ba),c('Event').listen(document.documentElement,'keydown',ca),c('Event').listen(document.documentElement,'mouseover',da),c('Event').listen(document.documentElement,'mousemove',da),c('Event').listen(document.documentElement,'click',function(event){this.handleMouse(event);}.bind(this)),c('Arbiter').subscribe('Event/stop',function(ea,fa){this.handleMouse(fa.event);}.bind(this)),c('Arbiter').subscribe('PhotoSnowlift.OPEN',function(){this.userFocus=t;this.handleLayers();}.bind(this)),c('Arbiter').subscribe('PhotoSnowlift.CLOSE',function(){this.userFocus=r;this.focusedStory=null;this.updateTimeTrackingData(false,'snowlift_close');}.bind(this)));this._userActivityPoller();}c('Run').onLeave(this.cleanup.bind(this));c('Run').onUnload(this.cleanup.bind(this));};v.prototype._getScrollListener=function(y){return c('Event').listen(window,'scroll',y);};v.prototype.cleanup=function(){if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}if(this.isTimetrackingEnabled){clearTimeout(this.userActivityPollerTimeoutID);this.updateTimeTrackingData(true,'cleanup');}if(this.annotatedVPVLogging){var y=this.getStoriesInView();y.forEach(this.logAnnotatedVPV,this);}this.initialStories=[];this._headLoadStoryCount=0;};v.prototype.fireTimer=function(){if(this.useWaterfallLogging){var y=c('ViewportTrackingHelper').getElementsInViewIgnoreHeight(this.behavior.getAllStories());y.forEach(function(fa){this.waterfallLogStep(fa,'100_all_stories_in_view_ignore_height',false);}.bind(this));}if(!this.initialStoriesLogged){this.initialStories.forEach(this.markStoryRead,this);this.initialStoriesLogged=true;}this.storiesInView=this.getStoriesInView();this.storiesInView.forEach(this.markStoryRead,this);if(this.trackingHooks){var z=this.isTimetrackingEnabled?this.getVisibleStoriesFromCache():this.getAllStoriesInView(),aa=[],ba=Object.keys(z);for(var ca=0,da=ba.length;ca<da;ca++){var ea=ba[ca];if(z[ea].story)aa.push(z[ea].story);}c('ViewportTrackingHooks').updateVisibleViewportObjects(aa);}};v.prototype.getSessionID=function(){return null;};v.prototype._userActivityPoller=function(){if(!this.userInactiveLock&&!c('UserActivity').isActive(this.timeToBeConsideredInactive)){this.userInactiveLock=true;this.userFocus=s;this.updateTimeTrackingData(false,'user_activity_inactive');c('UserActivity').subscribeOnce(function(){this.userFocus=r;this.updateTimeTrackingData(false,'user_activity_active');this.userInactiveLock=false;}.bind(this));}this.userActivityPollerTimeoutID=setTimeout(this._userActivityPoller.bind(this),this.userActivityPollingInterval);};v.prototype.getQueryID=function(y){return -1;};v.prototype.getFBFeedLocations=function(y){return -1;};v.prototype.getFBFeedInsertionPosition=function(y){return -1;};v.prototype.createVPVDTimer=function(y){var z=document.createElement('label');z.setAttribute('for',y.toString());z.setAttribute('class','vpvd_debug_timer');return z;};v.prototype.updateVPVDTimer=function(y){var z=this.activeStories[y].story;if(!z)return;var aa=c('DOM').scry(z,'.vpvd_debug_timer');if(!aa.length){aa=[this.createVPVDTimer(z),this.createVPVDTimer(z)];var ba=c('DOM').scry(z,'.UFIRow');if(ba.length&&ba[ba.length-1].clientWidth>0){ba[ba.length-1].appendChild(aa[0]);}else z.appendChild(aa[0]);z.insertBefore(aa[1],z.firstChild);}var ca=this.totalVPVDuration[y],da=Math.floor(ca/1000)+'.'+Math.floor(ca%1000/100);c('DOM').setContent(aa[0],da);c('DOM').setContent(aa[1],da);};v.prototype.updateVPVDTimers=function(){for(var y in this.activeStories)if(this.activeStories.hasOwnProperty(y))this.updateVPVDTimer(y);};v.prototype.logVpvdAnalysis=function(y,z,aa,ba,ca,da){var ea=new (c('BanzaiScuba'))('vpv_duration');ea.addDenorm('qid',this.getQueryID(this.activeStories[y].story));ea.addDenorm('uid',c('CurrentUser').getID());ea.addDenorm('vsid',y);ea.addInteger('time',Math.round(Date.now()/1000));ea.addInteger('duration',ba);ea.addInteger('total_duration',ca);ea.addNormal('story_state',this.activeStories[y].state);ea.addNormal('is_active_state',aa);ea.addNormal('num_visible_stories',this.numVisibleStories);ea.addInteger('story_height',this.activeStories[y].story_height);ea.addInteger('story_visible_height',this.activeStories[y].height);ea.addInteger('state_visible_height',da);ea.addInteger('total_visible_height',this.totalVisibleHeight);ea.addInteger('total_height',this.totalHeight);ea.addNormal('user_focus',this.latestUserFocus);ea.addNormal('next_user_focus',this.userFocus);ea.addInteger('vpvd',z);ea.addInteger('accumulated_vpvd',this.activeStories[y].vpvd);ea.addNormal('user_activity',this.latestUserActivity);ea.addNormal('next_user_activity',this.userActivity);ea.addInteger('story_position_y',this.activeStories[y].y);ea.addInteger('feed_insertion_position',this.getFBFeedInsertionPosition(this.activeStories[y].story));ea.addNormal('visible_position',this.activeStories[y].visible_position);ea.addNormal('is_focused_story',this.activeStories[y].is_focused);ea.post();};v.prototype.shouldDiscardStory=function(y){var z=this.activeStories[y].height||0;return z!=this.activeStories[y].story_height&&z<this.totalHeight/2;};v.prototype.calculateTotalHeight=function(){this.totalHeight=0;for(var y in this.activeStories)if(this.activeStories.hasOwnProperty(y))this.totalHeight+=this.activeStories[y].height;};v.prototype.updateVPVDurations=function(y){var z;if(this.latestUserFocus===s||y-this.latestTimeTrackingTimestamp>this.discardVPVDIntervalThreshold)return;var aa=(z={},z[p]=0,z[o]=0,z[n]=0,z),ba=y-this.latestTimeTrackingTimestamp>=this.focused_state_duration;this.totalVisibleHeight=0;for(var ca in this.activeStories)if(this.activeStories.hasOwnProperty(ca))if(!(this.latestUserFocus===r&&ba&&this.shouldDiscardStory(ca))){var da=this.activeStories[ca].state||null,ea=this.activeStories[ca].height||0;if(da!==null&&aa.hasOwnProperty(da))aa[da]+=ea;this.totalVisibleHeight+=ea;}var fa=0,ga=y-this.latestTimeTrackingTimestamp;if(this.latestUserFocus===r){ga=aa[n]>0?this.focused_state_duration:this.active_state_duration;ga=Math.min(ga,y-this.latestTimeTrackingTimestamp);fa=y-this.latestTimeTrackingTimestamp-ga;}var ha=0,ia=n;for(var ja=n;ja>=p;ja--)if(aa[ja]>0){ha=aa[ja];ia=ja;break;}var ka=aa[n]+aa[o]+aa[p],la=0;for(ca in this.activeStories)if(this.activeStories.hasOwnProperty(ca)){if(this.latestUserFocus===r&&ba&&this.shouldDiscardStory(ca))continue;var ma=this.activeStories[ca].state||q;if(ha>0&&ma>=ia){var na=this.activeStories[ca].height||0;la=ga*(na/ha);if(this.vpvdAnalysis&&ga>0)this.logVpvdAnalysis(ca,la,true,ga,ga+fa,ha);this.activeStories[ca].vpvd+=la;this.totalVPVDuration[ca]+=la;}if(ka>0){var oa=this.activeStories[ca].height||0;la=fa*(oa/ka);if(this.vpvdAnalysis&&fa>0)this.logVpvdAnalysis(ca,la,false,fa,ga+fa,ka);this.activeStories[ca].vpvd+=la;this.totalVPVDuration[ca]+=la;}}};v.prototype.updateActiveStory=function(y,z,aa,ba){this.activeStories[y].state=z;this.activeStories[y].ts=aa;this.activeStories[y].height_snapshot=ba[y].height;this.activeStories[y].is_focused=this.focusedStory===ba[y].story;this.activeStories[y].story_height=ba[y].story_height;if(this.vpvdAnalysis){this.activeStories[y].visible_position=ba[y].visible_position;this.activeStories[y].y=ba[y].y;}};v.prototype.updateActiveStories=function(y,z){for(var aa in y)if(y.hasOwnProperty(aa))if(aa in this.activeStories){var ba=y[aa].height||0;this.activeStories[aa].height=ba;var ca=ba-(this.activeStories[aa].height_snapshot||0);if(this.focusedStory===y[aa].story){this.updateActiveStory(aa,n,z,y);}else if(ca<=-this.height_diff_to_change_state){this.updateActiveStory(aa,this.shouldDiscardStory(aa)?q:p,z,y);}else if(ca>=this.height_diff_to_change_state||this.activeStories[aa].is_focused||this.activeStories[aa].height===this.activeStories[aa].story_height)this.updateActiveStory(aa,o,z,y);}else{this.activeStories[aa]={evp_ts:z,story:y[aa].story,height:y[aa].height,vpvd:0};if(!this.totalVPVDuration[aa])this.totalVPVDuration[aa]=0;this.updateActiveStory(aa,o,z,y);}};v.prototype.recordVPVDurations=function(y,z){for(var aa in this.activeStories)if(this.activeStories.hasOwnProperty(aa))if(z||!(aa in y)){var ba=this.activeStories[aa].vpvd||0;if(ba>this.focused_state_duration||ba===this.totalVPVDuration[aa])this.recordTimeStoryWasInView(this.activeStories[aa]);delete this.activeStories[aa];}};v.prototype.updateTimeTrackingData=function(y,z){this.userActivity=z;if(!this.activeStories)this.activeStories={};var aa=Date.now();if(!this.latestTimeTrackingTimestamp)this.latestTimeTrackingTimestamp=aa;var ba=this.getVisibleStoriesFromCache();this.calculateTotalHeight();this.updateVPVDurations(aa);this.updateActiveStories(ba,aa);if(this.vpvdDebug)this.updateVPVDTimers();this.recordVPVDurations(ba,y);if(y){this.latestTimeTrackingTimestamp=0;}else this.latestTimeTrackingTimestamp=aa;this.latestUserActivity=this.userActivity;this.latestUserFocus=this.userFocus;if(this.focusedStory)this.latestActiveStory=this.focusedStory;this.latestFocusedStory=this.focusedStory;this.focusedStory=null;};v.prototype.needsToUpdateTimeTrackingData=function(){return !(this.latestUserFocus===this.userFocus&&(this.userFocus===s||this.userFocus===r&&!this.latestFocusedStory&&!this.focusedStory));};v.prototype.getfocusedStory=function(y){var z=this.getVisibleStoriesFromCache();for(var aa in z)if(z.hasOwnProperty(aa)){var ba=z[aa].story;if(ba&&c('ViewportTrackingHelper').isDescendantOf(y,ba))return ba;}return null;};v.prototype.handleLayers=function(){if(this.userFocus===t||this.userFocus===u){this.focusedStory=this.latestActiveStory;this.updateTimeTrackingData(false,'media_layer');return true;}return false;};v.prototype.didInteractWithStream=function(y){if(!this.behavior.getStream)return false;var z=this.behavior.getStream();return c('ViewportTrackingHelper').isDescendantOf(y,z)||c('ViewportTrackingHelper').isDescendantOf(z,y);};v.prototype.handleScroll=function(event){if(this.handleLayers())return;var y=Date.now();!this.behavior.getStream?i(0):void 0;var z=c('getElementPosition')(this.behavior.getStream()).y;if(z!=this.lastStreamY||y-this.latestStreamYChangedTimeStamp<2.5*this.scrollThrottlingInterval||this.didInteractWithStream(event.target)){this.latestStreamYChangedTimeStamp=y;this.userFocus=r;}else this.userFocus=s;this.lastStreamY=z;if(this.userFocus===r||this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,'scroll');};v.prototype.handleKeyboard=function(event){if(this.handleLayers())return;if(this.didInteractWithStream(event.target)){this.userFocus=r;this.focusedStory=this.getfocusedStory(event.target);}else if(c('CSS').hasClass(event.target,'shareInput')){this.userFocus=r;this.focusedStory=this.latestActiveStory;}else this.userFocus=s;if(this.userFocus===r||this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,'keyboard');};v.prototype.handleMouse=function(event){if(this.handleLayers())return;if(event.type!='click'&&event.clientX===this.lastMouseX&&event.clientY===this.lastMouseY)return;if(event.type==='click')this.invalidateVisibleStoriesCache();if(this.didInteractWithStream(event.target)){this.userFocus=r;this.focusedStory=this.getfocusedStory(event.target);}else this.userFocus=s;this.lastMouseX=event.clientX;this.lastMouseY=event.clientY;if(this.needsToUpdateTimeTrackingData())this.updateTimeTrackingData(false,event.type);};v.prototype.getStoriesInView=function(){var y=this.behavior.getAllStories(),z=[],aa=false;for(var ba=0;ba<y.length;ba++){var ca=y[ba],da=this.behavior.getStoryID(ca);if(da&&this.hasBeenVisible(da))continue;if(c('ViewportTrackingHelper').isVisible(ca,this.minSizeToBeVisible,this.isLoose?this.maxScrollPosition:null)){if(ca.getAttribute('data-insertion-position')===null)ca.setAttribute('data-insertion-position',(ba-this._headLoadStoryCount).toString());z.push(ca);aa=true;}else if(aa)break;}return z;};v.prototype.getAllStoriesFromCache=function(){if(this.cachedAllStories.length===0)this.cachedAllStories=this.behavior.getAllStories();return this.cachedAllStories;};v.prototype.invalidateAllStoriesCache=function(){this.cachedAllStories=[];this.invalidateVisibleStoriesCache();};v.prototype.getVisibleStoriesFromCache=function(){if(!this.cachedVisibleStories.init)this.cachedVisibleStories={init:true,data:this.getAllStoriesInView()};return this.cachedVisibleStories.data;};v.prototype.invalidateVisibleStoriesCache=function(){this.cachedVisibleStories={init:false,data:{}};};v.prototype.getAllStoriesInView=function(){var y=this.getAllStoriesFromCache(),z={},aa=false,ba=0,ca=y.length,da=1,ea=y.length;if(this._indexOfLastVisibleStoryOnPreviousPass>ca/2){ba=ca-1;ca=-1;da=-da;}for(var fa=ba;fa!=ca;fa+=da){var ga=y[fa],ha=c('ViewportTrackingHelper').getHeightIfVisible(ga,Math.min(this.minSizeToBeVisible,this.minFractionToBeVisibleForTimetracking*c('DOMDimensions').getElementDimensions(ga).height));if(ha>0||ga===this.focusedStory){if(ga.getAttribute('data-insertion-position')===null)ga.setAttribute('data-insertion-position',(fa-this._headLoadStoryCount).toString());var ia=this.behavior.getStoryID(ga);if(ia){z[ia]={story:ga,height:ha,story_height:c('DOMDimensions').getElementDimensions(ga).height};aa=true;if(this.vpvdAnalysis){z[ia].y=c('getElementPosition')(ga).y;z[ia].visible_position=fa;ea=Math.min(ea,fa);}}}else if(aa){this._indexOfLastVisibleStoryOnPreviousPass=fa-da;break;}}if(this.vpvdAnalysis){this.numVisibleStories=0;for(ia in z)if(z.hasOwnProperty(ia)){z[ia].visible_position-=ea;this.numVisibleStories++;}}return z;};v.prototype.getTimetrackingDataToLog=function(y){var z={evt:j,vpvd_start_timestamp:y.evp_ts||null,vpvd_time_delta:Math.round(y.vpvd||0),story_height:c('DOMDimensions').getElementDimensions(y.story).height,viewport_height:this.cachedViewportHeight};return {ft:z};};v.prototype.recordTimeStoryWasInView=function(y){if(!this.isTimetrackingEnabled)return;if(!y.vpvd||!y.story)return;if(y.vpvd>0){var z=this.getTimetrackingDataToLog(y),aa=c('collectDataAttributes')(y.story,['ft']);Object.assign(z.ft,aa.ft);var ba=!!aa.ft.ei&&z.ft.vpvd_time_delta>this.minTimeToReportImmediately;if(z.ei)delete z.ei;!y.story?i(0):void 0;this.sendDataToLog(y.story,z,ba);}};v.prototype.hasBeenVisible=function(y){return y in this.readStoryIDs;};v.prototype.sendDataToLog=function(y,z,aa){if(this.useBanzai){var ba={};if(aa)ba.delay=3000;var ca=this.getSessionID();if(ca)z.ft.session_id=ca;if(this.useWaterfallLogging&&z.ft.evt==k){z.ft.should_waterfall_logging=1;z.ft['interface']='www';var da=!this.initialStoriesLogged;this.waterfallLogStep(y,'200_sent_to_banzai',da);}c('Banzai').post('feed_tracking',z,ba);}else c('clickRefAction')(l,y,null,'FORCE',z);};v.prototype.waterfallLogStep=function(y,z,aa){var ba=this.behavior.getStoryID(y);if(!ba)return;if(this.loggedStoryIDs[z]&&this.loggedStoryIDs[z][ba])return;var ca=this.getWaterfallData(y,z,aa);if(!ca.qid)return;new (c('AsyncSignal'))(m,ca).send();if(!this.loggedStoryIDs[z])this.loggedStoryIDs[z]={};this.loggedStoryIDs[z][ba]=true;};v.prototype.getWaterfallData=function(y,z,aa){var ba=this._getDataToLogImpl(y),ca=c('collectDataAttributes')(y,['ft']);Object.assign(ba.ft,ca.ft);var da=ba.ft,ea=c('ViewportTrackingHelper').getHeightInViewport(y);da.height_in_viewport=ea?ea:null;da.step=z;da.is_initial_story=aa?1:0;da['interface']='www';return da;};v.prototype.markStoryRead=function(y){var z=this.behavior.getStoryID(y);if(!z||this.hasBeenVisible(z))return;this.readStoryIDs[z]=true;this.annotatedStoryIDs[z]=true;var aa=this._getDataToLogImpl(y),ba=c('collectDataAttributes')(y,['ft']);Object.assign(aa.ft,ba.ft);delete aa.ei;this.sendDataToLog(y,aa,false);c('CSS').addClass(y,"_x72");if(this.vpvDebug)c('CSS').addClass(y,"_5m7s");};v.prototype.logAnnotatedVPV=function(y){var z=this.behavior.getStoryID(y);if(!z||z in this.annotatedStoryIDs)return;this.annotatedStoryIDs[z]=true;var aa=this._getDataToLogImpl(y),ba=c('collectDataAttributes')(y,['ft']);Object.assign(aa.ft,ba.ft);delete aa.ei;aa.ft.vpv_ft_only=1;this.sendDataToLog(y,aa,false);};v.prototype._getDataToLogImpl=function(y){var z=this.behavior.getDataToLog(y);if(!z.ft)z.ft={};return z;};v.clearSingleton=function(){};var w={getAllStories:function y(){return [];},getStoryID:function y(z){return null;},getDataToLog:function y(z){return {};}},x=c('viewportTrackingBuilder')(function(y){return new v(w);});v.factory=x.factory.bind(x);v.singleton=x.singleton.bind(x);v.clearSingleton=x.clearSingleton.bind(x);v.getBehavior=function(){return w;};f.exports=v;}),null);
__d('collectSubtreeData',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(j,k,l,m,n){if(j.offsetWidth===0&&j.offsetHeight===0)return n;var o={};if(j.getAttribute)for(s=0;s<k.length;s++){u=k[s];var p=j.getAttribute(l[u]);if(p){o[u]={};var q=JSON.parse(p);for(var r in m)if(q[r]!==undefined){o[u][r]=true;if(n[u]===undefined)n[u]={};if(n[u][r]===undefined)n[u][r]=[];if(m[r].length>0)n[u][r].push(m[r]);n[u][r].push('('+q[r]);}}}for(var s=0;s<j.childNodes.length;s++){var t=j.childNodes[s];h(t,k,l,m,n);}for(var u in o)for(var v in o[u]){var w=n[u][v][n[u][v].length-1];if(w.length>0&&w.charAt(0)=='('){n[u][v][n[u][v].length-1]=w.substr(1);}else n[u][v].push(')');}return n;}function i(j,k){var l={};for(var m=0;m<k.length;++m)l[k[m]]='data-'+k[m];var n={tn:"","tn-debug":","},o={};h(j,k,l,n,o);for(var p in o)for(var q in o[p])o[p][q]=o[p][q].join('');return o;}f.exports=i;}),null);
__d('recordTNTreeData',['collectSubtreeData'],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j){var k={},l=c('collectSubtreeData')(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}f.exports=h;}),null);
__d('StreamViewportTracking',['DataAttributeUtils','DOM','DOMDimensions','ViewportTracking','ge','recordTNTreeData','viewportTrackingBuilder'],(function a(b,c,d,e,f,g){'use strict';var h,i;if(c.__markCompiled)c.__markCompiled();var j=51;function k(n,o,p){return {_stream:null,getDataFromConfig:function q(r,s){s.isTimetrackingEnabled=true;},getAllStories:function q(){var r=c('DOM').scry(this.getStream(),p);return r.filter(function(s){return c('DataAttributeUtils').getDataFt(s);});},getStream:function q(){if(o)return o;if(!this._stream)this._stream=c('ge')('home_stream');return this._stream;},getStoryID:function q(r){var s=JSON.parse(c('DataAttributeUtils').getDataFt(r));return s&&s.mf_story_key;},getDataToLog:function q(r){var s=this.getStream(),t=c('recordTNTreeData')(r,s),u=r.getAttribute('data-insertion-position');if(u!==null)t.inspos=u;t.evt=j;t.vpv_time=Math.round(Date.now()/1000);var v=c('DOM').scry(r,'.fbStoryAttachmentImage')[0];if(v){var w=c('DOMDimensions').getElementDimensions(v);t.story_image_height=w.height;t.story_image_width=w.width;}return {ft:t};}};}h=babelHelpers.inherits(l,c('ViewportTracking'));i=h&&h.prototype;l.prototype.getQueryID=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.qid;};l.prototype.getFBFeedLocations=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.fbfeed_location;};l.prototype.getFBFeedInsertionPosition=function(n){var o=JSON.parse(c('DataAttributeUtils').getDataFt(n));return o.insertion_position;};l.prototype.cleanup=function(){m.clearSingleton();i.cleanup.call(this);};function l(){h.apply(this,arguments);}var m=c('viewportTrackingBuilder')(function(n,o){var p=new l(k(n,o,'.uiStreamStory'));p.init(n);return p;});l.factory=m.factory.bind(m);l.singleton=m.singleton.bind(m);l.clearSingleton=m.clearSingleton.bind(m);l.getBehavior=k;f.exports=l;}),null);
__d('VideoFrameBuffer',[],(function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(i,j,k){'use strict';this.$VideoFrameBuffer2=j;this.$VideoFrameBuffer1=i;this.$VideoFrameBuffer3=k||'contain';}h.prototype.updateFrameBuffer=function(){'use strict';if(this.$VideoFrameBuffer4){this.$VideoFrameBuffer1.width=this.$VideoFrameBuffer4;this.$VideoFrameBuffer4=null;}if(this.$VideoFrameBuffer5){this.$VideoFrameBuffer1.height=this.$VideoFrameBuffer5;this.$VideoFrameBuffer5=null;}var i=this.$VideoFrameBuffer1.clientWidth||this.$VideoFrameBuffer1.width,j=this.$VideoFrameBuffer1.clientHeight||this.$VideoFrameBuffer1.height,k=i,l=j,m=this.$VideoFrameBuffer2.videoWidth/this.$VideoFrameBuffer2.videoHeight,n=k/l;if(this.$VideoFrameBuffer3==='cover'){n*=-1;m*=-1;}if(n>m){k=l*m;}else if(n<m)l=k/m;var o=this.$VideoFrameBuffer1.getContext('2d');if(!(o instanceof window.CanvasRenderingContext2D))return;o.drawImage(this.$VideoFrameBuffer2,(i-k)/2,(j-l)/2,k,l);};h.prototype.getDOMNode=function(){'use strict';return this.$VideoFrameBuffer1;};h.prototype.updateDimensions=function(i,j){'use strict';this.$VideoFrameBuffer4=i;this.$VideoFrameBuffer5=j;};f.exports=h;}),null);